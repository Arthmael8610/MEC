!function(){var Z=tinymce.util.Tools.resolve("tinymce.PluginManager"),O=tinymce.util.Tools.resolve("tinymce.util.Tools"),ab=tinymce.util.Tools.resolve("tinymce.util.XHR"),I=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),V=function(a){return a.getParam("template_cdate_classes","cdate")},K=function(a){return a.getParam("template_mdate_classes","mdate")},G=function(a){return a.getParam("template_selected_content_classes","selcontent")},N=function(a){return a.getParam("template_preview_replace_values")},R=function(a){return a.getParam("template_replace_values")},ad=function(a){return a.templates},aa=function(a){return a.getParam("template_cdate_format",a.getLang("template.cdate_format"))},Y=function(a){return a.getParam("template_mdate_format",a.getLang("template.mdate_format"))},X=function(a){return a.getParam("template_popup_width",600)},W=function(a){return Math.min(I.DOM.getViewPort().h,a.getParam("template_popup_height",500))},A=function(b,a){if((b=""+b).length<a){for(var c=0;c<a-b.length;c++){b="0"+b}}return b},F=function(h,f,m){var d="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),g="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),b="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),i="January February March April May June July August September October November December".split(" ");return m=m||new Date,f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=f.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+m.getFullYear())).replace("%y",""+m.getYear())).replace("%m",A(m.getMonth()+1,2))).replace("%d",A(m.getDate(),2))).replace("%H",""+A(m.getHours(),2))).replace("%M",""+A(m.getMinutes(),2))).replace("%S",""+A(m.getSeconds(),2))).replace("%I",""+((m.getHours()+11)%12+1))).replace("%p",m.getHours()<12?"AM":"PM")).replace("%B",""+h.translate(i[m.getMonth()]))).replace("%b",""+h.translate(b[m.getMonth()]))).replace("%A",""+h.translate(g[m.getDay()]))).replace("%a",""+h.translate(d[m.getDay()]))).replace("%%","%")},z=function(b,c,a){return O.each(a,function(f,d){"function"==typeof f&&(f=f(d)),c=c.replace(new RegExp("\\{\\$"+d+"\\}","g"),f)}),c},ae=function(f,c){var b=f.dom,d=R(f);O.each(b.select("*",c),function(a){O.each(d,function(h,g){b.hasClass(a,g)&&"function"==typeof d[g]&&d[g](a)})})},ac=function(b,a){return new RegExp("\\b"+a+"\\b","g").test(b.className)},Q=function(a,b){return function(){var c=ad(a);"function"!=typeof c?"string"==typeof c?ab.send({url:c,success:function(d){b(JSON.parse(d))}}):b(c):c(b)}},j=z,L=ae,B=function(f,h,m){var d,g,b=f.dom,i=f.selection.getContent();m=z(0,m,R(f)),d=b.create("div",null,m),(g=b.select(".mceTmpl",d))&&0<g.length&&(d=b.create("div",null)).appendChild(g[0].cloneNode(!0)),O.each(b.select("*",d),function(a){ac(a,V(f).replace(/\s+/g,"|"))&&(a.innerHTML=F(f,aa(f))),ac(a,K(f).replace(/\s+/g,"|"))&&(a.innerHTML=F(f,Y(f))),ac(a,G(f).replace(/\s+/g,"|"))&&(a.innerHTML=i)}),ae(f,d),f.execCommand("mceInsertContent",!1,d.innerHTML),f.addVisual()},U=function(a){a.addCommand("mceInsertTemplate",function(b){for(var f=[],d=1;d<arguments.length;d++){f[d-1]=arguments[d]}for(var h=new Array(arguments.length-1),g=1;g<arguments.length;g++){h[g-1]=arguments[g]}return function(){for(var m=[],i=0;i<arguments.length;i++){m[i]=arguments[i]}for(var o=new Array(arguments.length),c=0;c<o.length;c++){o[c]=arguments[c]}var l=h.concat(o);return b.apply(null,l)}}(B,a))},q=function(b){b.on("PreProcess",function(c){var a=b.dom,d=Y(b);O.each(a.select("div",c.node),function(f){a.hasClass(f,"mceTmpl")&&(O.each(a.select("*",f),function(g){a.hasClass(g,b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(g.innerHTML=F(b,d))}),L(b,f))})})},k=function(d,g,h){if(-1===h.indexOf("<html>")){var c="";O.each(d.contentCSS,function(a){c+='<link type="text/css" rel="stylesheet" href="'+d.documentBaseURI.toAbsolute(a)+'">'});var f=d.settings.body_class||"";-1!==f.indexOf("=")&&(f=(f=d.getParam("body_class","","hash"))[d.id]||""),h="<!DOCTYPE html><html><head>"+c+'</head><body class="'+f+'">'+h+"</body></html>"}h=j(d,h,N(d));var b=g.find("iframe")[0].getEl().contentWindow.document;b.open(),b.write(h),b.close()},E=function(h,g){var c,f,d=[];if(g&&0!==g.length){O.each(g,function(a){d.push({selected:!d.length,text:a.title,value:{url:a.url,content:a.content,description:a.description}})}),(c=h.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:d,onselect:function(i){var a=i.control.value();a.url?ab.send({url:a.url,success:function(l){k(h,c,f=l)}}):(f=a.content,k(h,c,f)),c.find("#description")[0].text(i.control.value().description)}}}]},{type:"label",name:"description",label:"Description",text:"\xa0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){B(h,!1,f)},minWidth:X(h),minHeight:W(h)})).find("listbox")[0].fire("select")}else{var b=h.translate("No templates defined.");h.notificationManager.open({text:b,type:"info"})}},J=function(a){return function(b){E(a,b)}},C=function(a){a.addButton("template",{title:"Insert template",onclick:Q(a.settings,J(a))}),a.addMenuItem("template",{text:"Template",onclick:Q(a.settings,J(a)),icon:"template",context:"insert"})};Z.add("template",function(a){C(a),U(a),q(a)})}();