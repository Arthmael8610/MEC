(function(a){window.MSBasicView=function(c){this.options={loop:false,dir:"h",autoHeight:false,spacing:5,mouseSwipe:true,swipe:true,speed:17,minSlideSpeed:2,viewNum:20,critMargin:1};a.extend(this.options,c);this.dir=this.options.dir;this.loop=this.options.loop;this.spacing=this.options.spacing;this.__width=0;this.__height=0;this.__cssProb=this.dir==="h"?"left":"top";this.__offset=this.dir==="h"?"offsetLeft":"offsetTop";this.__dimension=this.dir==="h"?"__width":"__height";this.__translate_end=window._css3d?" translateZ(0px)":"";this.$slideCont=a("<div></div>").addClass("ms-slide-container");this.$element=a("<div></div>").addClass("ms-view").addClass("ms-basic-view").append(this.$slideCont);this.currentSlide=null;this.index=-1;this.slidesCount=0;this.slides=[];this.slideList=[];this.viewSlidesList=[];this.css3=window._cssanim;this.start_buffer=0;this.firstslide_snap=0;this.slideChanged=false;this.controller=new Controller(0,0,{snapping:true,snapsize:100,paging:true,snappingMinSpeed:this.options.minSlideSpeed,friction:(100-this.options.speed*0.5)/100,endless:this.loop});this.controller.renderCallback(this.dir==="h"?this._horizUpdate:this._vertiUpdate,this);this.controller.snappingCallback(this.__snapUpdate,this);this.controller.snapCompleteCallback(this.__snapCompelet,this);averta.EventDispatcher.call(this)};var b=MSBasicView.prototype;b.__snapCompelet=function(c,d){if(!this.slideChanged){return}this.slideChanged=false;this.__locateSlides();this.start_buffer=0;this.dispatchEvent(new MSViewEvents(MSViewEvents.CHANGE_END))};b.__snapUpdate=function(d,c,g){if(this.loop){var f=this.index+g;this.updateLoop(f);if(f>=this.slidesCount){f=f-this.slidesCount}if(f<0){f=this.slidesCount+f}this.index=f}else{if(c<0||c>=this.slidesCount){return}this.index=c}this._checkCritMargins();if(a.browser.mozilla){this.slideList[this.index].$element[0].style.marginTop="0.1px";if(this.currentSlide){this.currentSlide.$element[0].style.marginTop=""}}var e=this.slideList[this.index];if(e===this.currentSlide){return}this.currentSlide=e;if(this.autoUpdateZIndex){this.__updateSlidesZindex()}this.slideChanged=true;this.dispatchEvent(new MSViewEvents(MSViewEvents.CHANGE_START))};b._checkCritMargins=function(){if(this.normalMode){return}var f=Math.floor(this.options.viewNum/2),e=this.viewSlidesList.indexOf(this.slideList[this.index]),d=(this[this.__dimension]+this.spacing),c=this.options.critMargin;if(this.loop){if(e<=c||e>=this.viewSlidesList.length-c){d*=(e-f);this.__locateSlides(false,d+this.start_buffer);this.start_buffer+=d}return}if((e<c&&this.index>=c)||(e>=this.viewSlidesList.length-c&&this.index<this.slidesCount-c)){this.__locateSlides(false)}};b._vertiUpdate=function(c,d){this.__contPos=d;this.dispatchEvent(new MSViewEvents(MSViewEvents.SCROLL));if(this.css3){this.$slideCont[0].style[window._jcsspfx+"Transform"]="translateY("+-d+"px)"+this.__translate_end;return}this.$slideCont[0].style.top=-d+"px"};b._horizUpdate=function(c,d){this.__contPos=d;this.dispatchEvent(new MSViewEvents(MSViewEvents.SCROLL));if(this.css3){this.$slideCont[0].style[window._jcsspfx+"Transform"]="translateX("+-d+"px)"+this.__translate_end;return}this.$slideCont[0].style.left=-d+"px"};b.__updateViewList=function(){if(this.normalMode){this.viewSlidesList=this.slides;return}var d=this.viewSlidesList.slice();this.viewSlidesList=[];var e=0,f=Math.floor(this.options.viewNum/2),c;if(this.loop){for(;e!==this.options.viewNum;e++){this.viewSlidesList.push(this.slides[this.currentSlideLoc-f+e])}}else{for(e=0;e!==f&&this.index-e!==-1;e++){this.viewSlidesList.unshift(this.slideList[this.index-e])}for(e=1;e!==f&&this.index+e!==this.slidesCount;e++){this.viewSlidesList.push(this.slideList[this.index+e])}}for(e=0,c=d.length;e!==c;e++){if(this.viewSlidesList.indexOf(d[e])===-1){d[e].sleep()}}d=null;if(this.currentSlide){this.__updateSlidesZindex()}};b.__locateSlides=function(e,h){this.__updateViewList();h=!this.loop?this.slides.indexOf(this.viewSlidesList[0])*(this[this.__dimension]+this.spacing):h||0;var d=this.viewSlidesList.length,c;for(var f=0;f!==d;f++){var g=h+f*(this[this.__dimension]+this.spacing);c=this.viewSlidesList[f];c.wakeup();c.position=g;c.$element[0].style[this.__cssProb]=g+"px"}if(e!==false){this.controller.changeTo(this.slideList[this.index].position,false,null,null,false)}};b.__createLoopList=function(){var d=[];var e=0,f=this.slidesCount/2;var c=(this.slidesCount%2===0)?f-1:Math.floor(f);var g=(this.slidesCount%2===0)?f:Math.floor(f);this.currentSlideLoc=c;for(e=1;e<=c;++e){d.unshift(this.slideList[(this.index-e<0)?this.slidesCount-e+this.index:this.index-e])}d.push(this.slideList[this.index]);for(e=1;e<=g;++e){d.push(this.slideList[(this.index+e>=this.slidesCount)?this.index+e-this.slidesCount:this.index+e])}return d};b.__getSteps=function(c,f){var d=(f<c)?this.slidesCount-c+f:f-c;var e=Math.abs(this.slidesCount-d);return(d<e)?d:-e};b.__pushEnd=function(){var e=this.slides.shift();var c=this.slides[this.slidesCount-2];this.slides.push(e);if(!this.normalMode){return}var d=c.$element[0][this.__offset]+this.spacing+this[this.__dimension];e.$element[0].style[this.__cssProb]=d+"px";e.position=d};b.__pushStart=function(){var c=this.slides.pop();var e=this.slides[0];this.slides.unshift(c);if(!this.normalMode){return}var d=e.$element[0][this.__offset]-this.spacing-this[this.__dimension];c.$element[0].style[this.__cssProb]=d+"px";c.position=d};b.__updateSlidesZindex=function(){var c,d=this.viewSlidesList.length,h=Math.floor(d/2);if(this.loop){var k=this.viewSlidesList.indexOf(this.currentSlide);for(var f=0;f!==d;f++){c=this.viewSlidesList[f];this.viewSlidesList[f].$element.css("z-index",f<=k?f+1:d-f)}}else{var e=this.currentSlide.index-this.viewSlidesList[0].index,g=d-e,j=e-g;for(var f=0;f!==d;f++){this.viewSlidesList[f].$element.css("z-index",f<=e?f+1:d-f)}this.currentSlide.$element.css("z-index",d)}};b.addSlide=function(c){c.view=this;this.slides.push(c);this.slideList.push(c);this.slidesCount++};b.appendSlide=function(c){this.$slideCont.append(c.$element)};b.updateLoop=function(e){if(this.loop){var d=this.__getSteps(this.index,e);for(var f=0,c=Math.abs(d);f<c;++f){if(d<0){this.__pushStart()}else{this.__pushEnd()}}}};b.gotoSlide=function(d,c){this.updateLoop(d);this.index=d;var e=this.slideList[d];this._checkCritMargins();this.controller.changeTo(e.position,!c,null,null,false);if(e===this.currentSlide){return}this.slideChanged=true;this.currentSlide=e;if(this.autoUpdateZIndex){this.__updateSlidesZindex()}this.dispatchEvent(new MSViewEvents(MSViewEvents.CHANGE_START));if(c){this.dispatchEvent(new MSViewEvents(MSViewEvents.CHANGE_END))}};b.next=function(c){if(c&&!this.loop&&this.index+1>=this.slidesCount){this.controller.bounce(10);return}this.gotoSlide((this.index+1>=this.slidesCount)?0:this.index+1)};b.previous=function(c){if(c&&!this.loop&&this.index-1<0){this.controller.bounce(-10);return}this.gotoSlide((this.index-1<0)?this.slidesCount-1:this.index-1)};b.setupSwipe=function(){this.swipeControl=new averta.TouchSwipe(this.$element);this.swipeControl.swipeType=this.dir==="h"?"horizontal":"vertical";var c=this;if(this.dir==="h"){this.swipeControl.onSwipe=function(d){c.horizSwipeMove(d)}}else{this.swipeControl.onSwipe=function(d){c.vertSwipeMove(d)}}};b.vertSwipeMove=function(d){var c=d.phase;if(c==="start"){this.controller.stop();this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_START,d))}else{if(c==="move"&&(!this.loop||Math.abs(this.currentSlide.position-this.controller.value+d.moveY)<this.cont_size/2)){this.controller.drag(d.moveY);this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_MOVE,d))}else{if(c==="end"||c==="cancel"){var f=d.distanceY/d.duration*50/3,e=Math.abs(d.distanceY/d.duration*50/3);if(Math.abs(f)>0.1&&Math.abs(f)>=e){this.controller.push(-f);if(f>this.controller.options.snappingMinSpeed){this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_END,d))}}else{this.controller.cancel();this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_CANCEL,d))}}}}};b.horizSwipeMove=function(d){var c=d.phase;if(c==="start"){this.controller.stop();this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_START,d))}else{if(c==="move"&&(!this.loop||Math.abs(this.currentSlide.position-this.controller.value+d.moveX)<this.cont_size/2)){this.controller.drag(d.moveX);this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_MOVE,d))}else{if(c==="end"||c==="cancel"){var e=d.distanceX/d.duration*50/3,f=Math.abs(d.distanceY/d.duration*50/3);if(Math.abs(e)>0.1&&Math.abs(e)>=f){this.controller.push(-e);if(e>this.controller.options.snappingMinSpeed){this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_END,d))}}else{this.controller.cancel();this.dispatchEvent(new MSViewEvents(MSViewEvents.SWIPE_CANCEL,d))}}}}};b.setSize=function(e,c,f){if(this.lastWidth===e&&c===this.lastHeight&&!f){return}this.$element.width(e).height(c);for(var d=0;d<this.slidesCount;++d){this.slides[d].setSize(e,c,f)}this.__width=e;this.__height=c;if(this.__created){this.__locateSlides();this.cont_size=(this.slidesCount-1)*(this[this.__dimension]+this.spacing);if(!this.loop){this.controller._max_value=this.cont_size}this.controller.options.snapsize=this[this.__dimension]+this.spacing;this.controller.changeTo(this.currentSlide.position,false,null,null,false);this.controller.cancel();this.lastWidth=e;this.lastHeight=c}};b.create=function(c){this.__created=true;this.index=Math.min((c||0),this.slidesCount-1);this.lastSnap=this.index;if(this.loop){this.slides=this.__createLoopList()}this.normalMode=this.slidesCount<=this.options.viewNum;for(var d=0;d<this.slidesCount;++d){this.slides[d].create()}this.__locateSlides();this.controller.options.snapsize=this[this.__dimension]+this.spacing;if(!this.loop){this.controller._max_value=(this.slidesCount-1)*(this[this.__dimension]+this.spacing)}this.gotoSlide(this.index,true);if(this.options.swipe&&(window._touch||this.options.mouseSwipe)){this.setupSwipe()}};b.destroy=function(){if(!this.__created){return}for(var c=0;c<this.slidesCount;++c){this.slides[c].destroy()}this.slides=null;this.slideList=null;this.$element.remove();this.controller.destroy();this.controller=null};averta.EventDispatcher.extend(b);MSSlideController.registerView("basic",MSBasicView)})(jQuery);