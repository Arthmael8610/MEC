(function(a){window.MSScrollParallax=function(d,e,c,f){this.fade=f;this.slider=d;this.parallax=e/100;this.bgparallax=c/100;d.api.addEventListener(MSSliderEvent.INIT,this.init,this);d.api.addEventListener(MSSliderEvent.DESTROY,this.destory,this);d.api.addEventListener(MSSliderEvent.CHANGE_END,this.resetLayers,this);d.api.addEventListener(MSSliderEvent.CHANGE_START,this.updateCurrentSlide,this)};window.MSScrollParallax.setup=function(d,e,c,f){if(window._mobile){return}if(e==null){e=50}if(c==null){c=40}return new MSScrollParallax(d,e,c,f)};var b=window.MSScrollParallax.prototype;b.init=function(h){this.slider.$element.addClass("ms-scroll-parallax");this.sliderOffset=this.slider.$element.offset().top;this.updateCurrentSlide();var g=this.slider.api.view.slideList,c;for(var f=0,d=g.length;f!==d;f++){c=g[f];if(c.hasLayers){c.layerController.$layers.wrap('<div class="ms-scroll-parallax-cont"></div>');c.$scrollParallaxCont=c.layerController.$layers.parent()}}a(window).on("scroll",{that:this},this.moveParallax).trigger("scroll")};b.resetLayers=function(d){if(!this.lastSlide){return}var c=this.lastSlide.$scrollParallaxCont;if(window._css2d){if(c){c[0].style[window._jcsspfx+"Transform"]=""}if(this.lastSlide.hasBG){this.lastSlide.$imgcont[0].style[window._jcsspfx+"Transform"]=""}}else{if(c){c[0].style.top=""}if(this.lastSlide.hasBG){this.lastSlide.$imgcont[0].style.top="0px"}}};b.updateCurrentSlide=function(c){this.lastSlide=this.currentSlide;this.currentSlide=this.slider.api.currentSlide;this.moveParallax({data:{that:this}})};b.moveParallax=function(i){var f=i.data.that,d=f.slider,j=f.sliderOffset,h=a(window).scrollTop(),g=f.currentSlide.$scrollParallaxCont,c=j-h;if(c<=0){if(g){if(window._css3d){g[0].style[window._jcsspfx+"Transform"]="translateY("+-c*f.parallax+"px) translateZ(0.4px)"}else{if(window._css2d){g[0].style[window._jcsspfx+"Transform"]="translateY("+-c*f.parallax+"px)"}else{g[0].style.top=-c*f.parallax+"px"}}}f.updateSlidesBG(-c*f.bgparallax+"px",true);if(g&&f.fade){g.css("opacity",(1-Math.min(1,-c/d.api.height)))}}else{if(g){if(window._css2d){g[0].style[window._jcsspfx+"Transform"]=""}else{g[0].style.top=""}}f.updateSlidesBG("0px",false);if(g&&f.fade){g.css("opacity",1)}}};b.updateSlidesBG=function(h,g){var f=this.slider.api.view.slideList,c=(g&&!a.browser.msie&&!a.browser.opera?"fixed":"");for(var e=0,d=f.length;e!==d;e++){if(f[e].hasBG){f[e].$imgcont[0].style.position=c;f[e].$imgcont[0].style.top=h}if(f[e].$bgvideocont){f[e].$bgvideocont[0].style.position=c;f[e].$bgvideocont[0].style.top=h}}};b.destory=function(){slider.api.removeEventListener(MSSliderEvent.INIT,this.init,this);slider.api.removeEventListener(MSSliderEvent.DESTROY,this.destory,this);slider.api.removeEventListener(MSSliderEvent.CHANGE_END,this.resetLayers,this);slider.api.removeEventListener(MSSliderEvent.CHANGE_START,this.updateCurrentSlide,this);a(window).off("scroll",this.moveParallax)}})(jQuery);