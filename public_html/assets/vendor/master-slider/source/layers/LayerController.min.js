(function(b,a,c){b.MSLayerController=function(e){this.slide=e;this.slider=e.slider;this.layers=[];this.layersCount=0;this.preloadCount=0;this.$layers=c("<div></div>").addClass("ms-slide-layers");this.$staticLayers=c("<div></div>").addClass("ms-static-layers");this.$fixedLayers=c("<div></div>").addClass("ms-fixed-layers");this.$animLayers=c("<div></div>").addClass("ms-anim-layers")};var d=MSLayerController.prototype;d.addLayer=function(e){e.slide=this.slide;e.controller=this;switch(e.$element.data("position")){case"static":this.hasStaticLayer=true;e.$element.appendTo(this.$staticLayers);break;case"fixed":this.hasFixedLayer=true;e.$element.appendTo(this.$fixedLayers);break;default:e.$element.appendTo(this.$animLayers);break}e.create();this.layers.push(e);this.layersCount++;if(e.parallax){this.hasParallaxLayer=true}if(e.needPreload){this.preloadCount++}};d.create=function(){this.slide.$element.append(this.$layers);this.$layers.append(this.$animLayers);if(this.hasStaticLayer){this.$layers.append(this.$staticLayers)}if(this.slider.options.layersMode=="center"){this.$layers.css("max-width",this.slider.options.width+"px");if(this.hasFixedLayer){this.$fixedLayers.css("max-width",this.slider.options.width+"px")}}};d.loadLayers=function(f){this._onReadyCallback=f;if(this.preloadCount===0){this._onlayersReady();return}for(var e=0;e!==this.layersCount;++e){if(this.layers[e].needPreload){this.layers[e].loadImage()}}};d.prepareToShow=function(){if(this.hasParallaxLayer){this._enableParallaxEffect()}if(this.hasFixedLayer){this.$fixedLayers.prependTo(this.slide.view.$element)}};d.showLayers=function(){if(this.layersHideTween){this.layersHideTween.stop(true)}if(this.fixedLayersHideTween){this.fixedLayersHideTween.stop(true)}this._resetLayers();this.$animLayers.css("opacity","").css("display","");if(this.hasFixedLayer){this.$fixedLayers.css("opacity","").css("display","")}if(this.ready){this._initLayers();this._locateLayers();this._startLayers()}};d.hideLayers=function(){if(this.slide.selected||this.slider.options.instantStartLayers){var e=this;e.layersHideTween=CTween.animate(this.$animLayers,500,{opacity:0},{complete:function(){e._resetLayers()}});if(this.hasFixedLayer){this.fixedLayersHideTween=CTween.animate(this.$fixedLayers,500,{opacity:0},{complete:function(){e.$fixedLayers.detach()}})}if(this.hasParallaxLayer){this._disableParallaxEffect()}}};d.animHideLayers=function(){if(!this.ready){return}for(var e=0;e!==this.layersCount;++e){this.layers[e].hide()}};d.setSize=function(f,e,h){if(this.ready&&(this.slide.selected||this.hasStaticLayer)){if(h){this._initLayers(true)}this._locateLayers(!this.slide.selected)}if(this.slider.options.autoHeight){this.updateHeight()}if(this.slider.options.layersMode=="center"){var g=Math.max(0,(f-this.slider.options.width)/2)+"px";this.$layers[0].style.left=g;this.$fixedLayers[0].style.left=g}};d.updateHeight=function(){};d._onlayersReady=function(){this.ready=true;if(this.hasStaticLayer&&!this.slide.isSleeping){this._initLayers(false,true)}this._onReadyCallback.call(this.slide)};d.onSlideSleep=function(){};d.onSlideWakeup=function(){if(this.hasStaticLayer&&this.ready){this._initLayers(false,true)}};d.getLayerById=function(e){if(!e){return null}for(var f=0;f<this.layersCount;++f){if(this.layers[f].id===e){return this.layers[f]}}return null};d.destroy=function(){if(this.slide.selected&&this.hasParallaxLayer){this._disableParallaxEffect()}for(var e=0;e<this.layersCount;++e){this.layers[e].$element.stop(true).remove()}this.$layers.remove();this.$staticLayers.remove();this.$fixedLayers.remove();this.$animLayers.remove()};d._startLayers=function(){for(var f=0;f!==this.layersCount;++f){var e=this.layers[f];if(!e.waitForAction){e.start()}}};d._initLayers=function(g,f){if(this.init&&!g||this.slider.init_safemode){return}this.init=f!==true;var e=0;if(f&&!this.staticsInit){this.staticsInit=true;for(;e!==this.layersCount;++e){if(this.layers[e].staticLayer){this.layers[e].init()}}}else{if(this.staticsInit&&!g){for(;e!==this.layersCount;++e){if(!this.layers[e].staticLayer){this.layers[e].init()}}}else{for(;e!==this.layersCount;++e){this.layers[e].init()}}}};d._locateLayers=function(f){var e=0;if(f){for(;e!==this.layersCount;++e){if(this.layers[e].staticLayer){this.layers[e].locate()}}}else{for(;e!==this.layersCount;++e){this.layers[e].locate()}}};d._resetLayers=function(){this.$animLayers.css("display","none").css("opacity",1);for(var e=0;e!==this.layersCount;++e){this.layers[e].reset()}};d._applyParallax=function(e,h,f){for(var g=0;g!==this.layersCount;++g){if(this.layers[g].parallax!=null){this.layers[g].moveParallax(e,h,f)}}};d._enableParallaxEffect=function(){if(this.slider.options.parallaxMode==="swipe"){this.slide.view.addEventListener(MSViewEvents.SCROLL,this._swipeParallaxMove,this)}else{this.slide.$element.on("mousemove",{that:this},this._mouseParallaxMove).on("mouseleave",{that:this},this._resetParalax)}};d._disableParallaxEffect=function(){if(this.slider.options.parallaxMode==="swipe"){this.slide.view.removeEventListener(MSViewEvents.SCROLL,this._swipeParallaxMove,this)}else{this.slide.$element.off("mousemove",this._mouseParallaxMove).off("mouseleave",this._resetParalax)}};d._resetParalax=function(g){var f=g.data.that;f._applyParallax(0,0)};d._mouseParallaxMove=function(j){var h=j.data.that,i=h.slide.$element.offset(),g=h.slider;if(g.options.parallaxMode!=="mouse:y-only"){var f=j.pageX-i.left-h.slide.__width/2}else{var f=0}if(g.options.parallaxMode!=="mouse:x-only"){var k=j.pageY-i.top-h.slide.__height/2}else{var k=0}h._applyParallax(-f,-k)};d._swipeParallaxMove=function(g){var f=this.slide.position-this.slide.view.__contPos;if(this.slider.options.dir==="v"){this._applyParallax(0,f,true)}else{this._applyParallax(f,0,true)}}})(window,document,jQuery);