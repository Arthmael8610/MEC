(function(a){window.MSLayerElement=function(){this.start_anim={name:"fade",duration:1000,ease:"linear",delay:0};this.end_anim={duration:1000,ease:"linear"};this.type="text";this.resizable=true;this.minWidth=-1;this.isVisible=true;this.__cssConfig=["margin-top","padding-top","margin-bottom","padding-left","margin-right","padding-right","margin-left","padding-bottom","font-size","line-height","width","left","right","top","bottom"];this.baseStyle={}};var b=MSLayerElement.prototype;b.setStartAnim=function(c){a.extend(this.start_anim,c);a.extend(this.start_anim,this._parseEff(this.start_anim.name));this.$element.css("visibility","hidden")};b.setEndAnim=function(c){a.extend(this.end_anim,c)};b.create=function(){this.$element.css("display","none");this.resizable=this.$element.data("resize")!==false;this.fixed=this.$element.data("fixed")===true;if(this.$element.data("widthlimit")!==undefined){this.minWidth=this.$element.data("widthlimit")}if(!this.end_anim.name){this.end_anim.name=this.start_anim.name}if(this.end_anim.time){this.autoHide=true}this.staticLayer=this.$element.data("position")==="static";this.fixedLayer=this.$element.data("position")==="fixed";this.layersCont=this.controller.$layers;if(this.staticLayer){this.$element.css("display","").css("visibility","")}if(this.$element.data("action")!==undefined){var f=this.slide.slider.slideController;this.$element.on(this.$element.data("action-event")||"click",function(j){f.runAction(a(this).data("action"));j.preventDefault()}).addClass("ms-action-layer")}a.extend(this.end_anim,this._parseEff(this.end_anim.name));this.slider=this.slide.slider;if(this.masked){this.$mask=a("<div></div>").addClass("ms-layer-mask");if(this.link){this.link.wrap(this.$mask);this.$mask=this.link.parent()}else{this.$element.wrap(this.$mask);this.$mask=this.$element.parent()}if(this.maskWidth){this.$mask.width(this.maskWidth)}if(this.maskHeight){this.$mask.height(this.maskHeight);if(this.__cssConfig.indexOf("height")===-1){this.__cssConfig.push("height")}}}var e=this.layerOrigin=this.$element.data("origin");if(e){var d=e.charAt(0),h=e.charAt(1),c=this.$element.data("offset-x"),i=this.$element.data("offset-y"),g=this.masked?this.$mask[0]:this.$element[0];if(i===undefined){i=0}switch(d){case"t":g.style.top=i+"px";break;case"b":g.style.bottom=i+"px";break;case"m":g.style.top=i+"px";this.middleAlign=true}if(c===undefined){c=0}switch(h){case"l":g.style.left=c+"px";break;case"r":g.style.right=c+"px";break;case"c":g.style.left=c+"px";this.centerAlign=true}}this.parallax=this.$element.data("parallax");if(this.parallax!=null){this.parallax/=100;this.$parallaxElement=a("<div></div>").addClass("ms-parallax-layer");if(this.masked){this.$mask.wrap(this.$parallaxElement);this.$parallaxElement=this.$mask.parent()}else{if(this.link){this.link.wrap(this.$parallaxElement);this.$parallaxElement=this.link.parent()}else{this.$element.wrap(this.$parallaxElement);this.$parallaxElement=this.$element.parent()}}this._lastParaX=0;this._lastParaY=0;this._paraX=0;this._paraY=0;this.alignedToBot=this.layerOrigin&&this.layerOrigin.indexOf("b")!==-1;if(this.alignedToBot){this.$parallaxElement.css("bottom",0)}if(window._css3d){this.parallaxRender=this._parallaxCSS3DRenderer}else{if(window._css2d){this.parallaxRender=this._parallaxCSS2DRenderer}else{this.parallaxRender=this._parallax2DRenderer}}if(this.slider.options.parallaxMode!=="swipe"){averta.Ticker.add(this.parallaxRender,this)}}a.removeDataAttrs(this.$element,["data-src"])};b.init=function(){this.initialized=true;var g;this.$element.css("visibility","");for(var e=0,c=this.__cssConfig.length;e<c;e++){var d=this.__cssConfig[e];if(this._isPosition(d)&&this.masked){g=this.$mask.css(d)}else{if(this.type==="text"&&d==="width"&&!this.masked&&!this.maskWidth){g=this.$element[0].style.width}else{g=this.$element.css(d);var f=d==="width"||d==="height";if(f&&this.masked){if(this.maskWidth&&d==="width"){g=this.maskWidth+"px"}else{if(this.maskHeight&&d==="height"){g=this.maskHeight+"px"}}}if(f&&g==="0px"){g=this.$element.data(d)+"px"}}}if(this.layerOrigin&&((d==="top"&&this.layerOrigin.indexOf("t")===-1&&this.layerOrigin.indexOf("m")===-1)||(d==="bottom"&&this.layerOrigin.indexOf("b")===-1)||(d==="left"&&this.layerOrigin.indexOf("l")===-1&&this.layerOrigin.indexOf("c")===-1)||(d==="right"&&this.layerOrigin.indexOf("r")===-1))){continue}if(g!="auto"&&g!=""&&g!="normal"){this.baseStyle[d]=parseInt(g)}}if(this.middleAlign){this.baseHeight=this.$element.outerHeight(false)}if(this.centerAlign){this.baseWidth=this.$element.outerWidth(false)}};b.locate=function(){if(!this.slide.ready){return}var g=parseFloat(this.layersCont.css("width")),c=parseFloat(this.layersCont.css("height")),e,i,f;if(!this.staticLayer&&this.$element.css("display")==="none"&&this.isVisible){this.$element.css("display","").css("visibility","hidden")}if(this.staticLayer){this.$element.addClass("ms-hover-active")}e=this.resizeFactor=g/this.slide.slider.options.width;var h=this.masked?this.$mask:this.$element;for(var d in this.baseStyle){i=this._isPosition(d);f=d==="width"||d==="height";if(this.fixed&&i){e=1}else{e=this.resizeFactor}if(!this.resizable&&!i){continue}if(d==="top"&&this.middleAlign){h[0].style.top="0px";this.baseHeight=h.outerHeight(false);h[0].style.top=this.baseStyle.top*e+(c-this.baseHeight)/2+"px"}else{if(d==="left"&&this.centerAlign){h[0].style.left="0px";this.baseWidth=h.outerWidth(false);h[0].style.left=this.baseStyle.left*e+(g-this.baseWidth)/2+"px"}else{if(i&&this.masked){h[0].style[d]=this.baseStyle[d]*e+"px"}else{if(f&&((d==="width"&&this.maskWidth)||(d==="height"&&this.maskHeight))){h[0].style[d]=this.baseStyle[d]*e+"px"}else{this.$element.css(d,this.baseStyle[d]*e+"px")}}}}}this.visible(this.minWidth<g)};b.start=function(){if(this.isShowing||this.staticLayer){return}this.isShowing=true;this.$element.removeClass("ms-hover-active");var c,g;MSLayerEffects.rf=this.resizeFactor;var d=MSLayerEffects[this.start_anim.eff_name].apply(null,this._parseEffParams(this.start_anim.eff_params));var f={};for(c in d){if(this._checkPosKey(c,d)){continue}if(MSLayerEffects.defaultValues[c]!=null){f[c]=MSLayerEffects.defaultValues[c]}if(c in this.baseStyle){g=this.baseStyle[c];if(this.middleAlign&&c==="top"){g+=(parseInt(this.layersCont.height())-this.$element.outerHeight(false))/2}if(this.centerAlign&&c==="left"){g+=(parseInt(this.layersCont.width())-this.$element.outerWidth(false))/2}d[c]=g+parseFloat(d[c])+"px";f[c]=g+"px"}this.$element.css(c,d[c])}var e=this;clearTimeout(this.to);clearTimeout(this.clHide);this.to=setTimeout(function(){e.$element.css("visibility","");e._playAnimation(e.start_anim,f)},e.start_anim.delay||0.01);this.clTo=setTimeout(function(){e.show_cl=true;e.$element.addClass("ms-hover-active")},(this.start_anim.delay||0.01)+this.start_anim.duration+1);if(this.autoHide){clearTimeout(this.hto);this.hto=setTimeout(function(){e.hide()},e.end_anim.time)}};b.hide=function(){if(this.staticLayer){return}this.$element.removeClass("ms-hover-active");this.isShowing=false;var c=MSLayerEffects[this.end_anim.eff_name].apply(null,this._parseEffParams(this.end_anim.eff_params));for(key in c){if(this._checkPosKey(key,c)){continue}if(key===window._jcsspfx+"TransformOrigin"){this.$element.css(key,c[key])}if(key in this.baseStyle){c[key]=this.baseStyle[key]+parseFloat(c[key])+"px"}}this._playAnimation(this.end_anim,c);clearTimeout(this.clHide);if(c.opacity===0){this.clHide=setTimeout(function(){this.$element.css("visibility","hidden")}.bind(this),this.end_anim.duration+1)}clearTimeout(this.to);clearTimeout(this.hto);clearTimeout(this.clTo)};b.reset=function(){if(this.staticLayer){return}this.isShowing=false;this.$element[0].style.display="none";this.$element.css("opacity","");this.$element[0].style.transitionDuration="";if(this.show_tween){this.show_tween.stop(true)}clearTimeout(this.to);clearTimeout(this.hto)};b.destroy=function(){this.reset();this.$element.remove()};b.visible=function(c){if(this.isVisible==c){return}this.isVisible=c;this.$element.css("display",(c?"":"none"))};b.moveParallax=function(c,e,d){this._paraX=c;this._paraY=e;if(d){this._lastParaX=c;this._lastParaY=e;this.parallaxRender()}};b._playAnimation=function(e,d){var c={};if(e.ease){c.ease=e.ease}c.transProperty=window._csspfx+"transform,opacity";if(this.show_tween){this.show_tween.stop(true)}this.show_tween=CTween.animate(this.$element,e.duration,d,c)};b._randomParam=function(e){var d=Number(e.slice(0,e.indexOf("|")));var c=Number(e.slice(e.indexOf("|")+1));return d+Math.random()*(c-d)};b._parseEff=function(g){var h=[];if(g.indexOf("(")!==-1){var d=g.slice(0,g.indexOf("(")).toLowerCase();var f;h=g.slice(g.indexOf("(")+1,-1).replace(/\"|\'|\s/g,"").split(",");g=d;for(var e=0,c=h.length;e<c;++e){f=h[e];if(f in MSLayerEffects.presetEffParams){f=MSLayerEffects.presetEffParams[f]}h[e]=f}}return{eff_name:g,eff_params:h}};b._parseEffParams=function(f){var g=[];for(var d=0,c=f.length;d<c;++d){var e=f[d];if(typeof e==="string"&&e.indexOf("|")!==-1){e=this._randomParam(e)}g[d]=e}return g};b._checkPosKey=function(c,d){if(c==="left"&&!(c in this.baseStyle)&&"right" in this.baseStyle){d.right=-parseInt(d.left)+"px";delete d.left;return true}if(c==="top"&&!(c in this.baseStyle)&&"bottom" in this.baseStyle){d.bottom=-parseInt(d.top)+"px";delete d.top;return true}return false};b._isPosition=function(c){return c==="top"||c==="left"||c==="bottom"||c==="right"};b._parallaxCalc=function(){var c=this._paraX-this._lastParaX,d=this._paraY-this._lastParaY;this._lastParaX+=c/12;this._lastParaY+=d/12;if(Math.abs(c)<0.019){this._lastParaX=this._paraX}if(Math.abs(d)<0.019){this._lastParaY=this._paraY}};b._parallaxCSS3DRenderer=function(){this._parallaxCalc();this.$parallaxElement[0].style[window._jcsspfx+"Transform"]="translateX("+this._lastParaX*this.parallax+"px) translateY("+this._lastParaY*this.parallax+"px) translateZ(0)"};b._parallaxCSS2DRenderer=function(){this._parallaxCalc();this.$parallaxElement[0].style[window._jcsspfx+"Transform"]="translateX("+this._lastParaX*this.parallax+"px) translateY("+this._lastParaY*this.parallax+"px)"};b._parallax2DRenderer=function(){this._parallaxCalc();if(this.alignedToBot){this.$parallaxElement[0].style.bottom=this._lastParaY*this.parallax+"px"}else{this.$parallaxElement[0].style.top=this._lastParaY*this.parallax+"px"}this.$parallaxElement[0].style.left=this._lastParaX*this.parallax+"px"}})(jQuery);