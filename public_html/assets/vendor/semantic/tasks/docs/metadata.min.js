var console=require("better-console"),fs=require("fs"),YAML=require("yamljs");var data={};function startsWith(b,a){return b.indexOf(a)===0}function inArray(d,c){var b=c.length;for(var a=0;a<b;a++){if(c[a]==d){return true}}return false}function parser(b,j){if(b.isNull()){return j(null,b)}if(b.isStream()){return j(new Error("Streaming not supported"))}try{var k=String(b.contents.toString("utf8")),o=k.split("\n"),a=b.path.substring(0,b.path.length-4),h="server/documents",e=a.indexOf(h);if(!o){return}if(e<0){return j(null,b)}a=a.substring(e+h.length+1,a.length);var m=o.length,c=false,i=[],d=["UI Element","UI Global","UI Collection","UI View","UI Module","UI Behavior"],f,l,n;for(f=0;f<m;f++){n=o[f];if(!c){if(startsWith(n,"---")){c=true}continue}if(startsWith(n,"---")){break}i.push(n)}l=YAML.parse(i.join("\n"));if(l&&l.type&&l.title&&inArray(l.type,d)){l.category=l.type;l.filename=a;l.url="/"+a;l.title=l.title;data[l.element]=l}else{}}catch(g){console.log(g,a)}j(null,b)}module.exports={result:data,parser:parser};