(function(){var g,e,d=window.requestAnimationFrame;window.RsAddonPanorama=function(j,i){if(!e){e=f();if(!e){i.addClass("pano-no-webgl");return}}if(!j||!i||typeof THREE==="undefined"||!d){return}if(!i.find("li[data-panorama]").length){return}g=j;g.event.special.rsPanoramaDestroyed={remove:function(k){k.handler()}};return new c(i)};function c(i){this.slider=i;this.slides=[];this.panos=i.find("li[data-panorama]").each(function(j){if(j===0){this.setAttribute("data-fstransition","notransition")}this.setAttribute("data-transition","fade")});i.one("revolution.slide.onloaded",this.onLoaded.bind(this)).one("rsPanoramaDestroyed",this.destroy.bind(this))}c.prototype={onLoaded:function(){this.slider.one("revolution.slide.onchange",this.onReady.bind(this));jQuery(window).on("blur.rsaddonpanorama",this.onBlur.bind(this))},onReady:function(l,j){this.resize();var k=this;this.panos.each(function(m){k.slides[m]=new a(g(this),k.slider,k.width,k.height)});this.slider.on("revolution.slide.afterdraw",this.resize.bind(this)).on("revolution.slide.onbeforeswap",this.beforeSwap.bind(this)).on("revolution.slide.onafterswap",this.afterSwap.bind(this)).on("layeraction",this.layerAction.bind(this));var i=g.data(j.currentslide[0],"rsaddonpanorama");if(i){i.onReset()}this.panos=null},beforeSwap:function(k,j){var i=g.data(j.currentslide[0],"rsaddonpanorama");if(i&&i.controls){i.removeEvents()}i=g.data(j.nextslide[0],"rsaddonpanorama");if(i){i.onReset()}},afterSwap:function(k,j){this.currentSlide=g.data(j.currentslide[0],"rsaddonpanorama");if(!j.prevslide.length){return}var i=g.data(j.prevslide[0],"rsaddonpanorama");if(i){i.paused=true}},resize:function(){this.width=this.slider.width();this.height=this.slider.height();var k=this.slides.length,j;while(k--){j=this.slides[k];j.resize(this.width,this.height)}},onBlur:function(){var k=this.slides.length,j;while(k--){j=this.slides[k];j.clear();j.canvas.trigger("mouseup").trigger("mouseleave").trigger("touchend")}},layerAction:function(l,k){k=k.event;var j=k.action;if(j&&j.search("panorama")!==-1&&this.currentSlide){var i=k.hasOwnProperty("percentage")?k.percentage*0.01:false;this.currentSlide.action(j.replace("panorama_",""),i)}},destroy:function(){if(this.slides){while(this.slides.length){this.slides[0].destroy();this.slides.shift()}}for(var i in this){if(this.hasOwnProperty(i)){delete this[i]}}}};function a(j,n,m,i){var l=JSON.parse(j.attr("data-panorama"));this.x=0;this.y=0;this.zoomVal=1;this.width=m;this.height=i;this.slide=j;this.slider=n;this.distX=false;this.distY=false;this.image=l.image;this.controls=l.controls;this.drag=this.controls==="drag";this.thrw=this.controls==="throw";this.move=this.drag||this.thrw;this.mouse=this.controls==="mouse";this.click=this.controls==="click";this.autoplay=l.autoplay=="true";this.zoom=l.mousewheelZoom=="true";this.smoothZoom=l.smoothZoom=="true";var o=l.autoplayDirection==="forward"?1:-1;this.autoplaySpeed=parseInt(l.autoplaySpeed,10)*0.001;this.speed=this.autoplaySpeed*o;this.throwSpeed=parseInt(l.throwSpeed,10)*0.001;this.zoomMax=2-(parseInt(l.zoomMax,10)*0.01);this.zoomMin=2-(parseInt(l.zoomMin,10)*0.01);this.fov=parseInt(l.cameraFov,10);this.onStart=this.start.bind(this);this.onZoom=this.zooming.bind(this);this.inZoom=this.zoomIn.bind(this);this.outZoom=this.zoomOut.bind(this);this.onRender=this.render.bind(this);this.onMouse=this.mouseEvent.bind(this);this.onImgChange=this.imgChange.bind(this);this.fireAction=this.onAction.bind(this);this.renderer=new THREE[e]();this.renderer.setSize(m,i);this.camera=new THREE.PerspectiveCamera(this.fov,m/i,1,parseInt(l.cameraFar,10));this.camera.target=new THREE.Vector3(0,0,0);var k=new THREE.SphereGeometry(parseInt(l.sphereRadius,10),parseInt(l.sphereWsegments,10),parseInt(l.sphereHsegments,10));this.texture=new THREE.TextureLoader();this.texture.minFilter=THREE.LinearFilter;k.applyMatrix(new THREE.Matrix4().makeScale(-1,1,1));this.material=new THREE.MeshBasicMaterial();this.scene=new THREE.Scene();this.scene.add(new THREE.Mesh(k,this.material));g.data(j[0],"rsaddonpanorama",this);this.canvas=g(this.renderer.domElement).addClass("rsaddon-panorama").appendTo(j.find(".slotholder"));j.on("mouseleave",this.onLeave.bind(this)).find(".tp-withaction").each(h)}a.prototype={start:function(){if(!this.imgLoaded){this.imgLoaded=true}if(!this.currentSlide){return}if(this.newImage){this.x=0;this.y=0;this.zoomVal=1;this.camera.fov=this.fov;this.camera.updateProjectionMatrix();this.newImage=false}this.controller=false;this.paused=false;d(this.onRender);this.addEvents();this.running=true;this.slider.addClass("rsaddon-pano")},render:function(){if(this.paused||!this.camera){return}this.y=Math.max(-85,Math.min(85,this.y));if(this.distX!==false||this.distY!==false){if(this.distX!==false){this.x+=(this.distX-this.x)*0.05;if(Math.abs(this.distX-this.x)<1){this.distX=false;clearInterval(this.actionTimer)}}else{if(this.distY!==false){this.y+=(this.distY-this.y)*0.05;if(Math.abs(this.distY-this.y)<1){this.distY=false;clearInterval(this.actionTimer)}}}}else{if(!this.controller){if(this.autoplay){this.x+=this.speed}}else{if(!this.move){var l=(this.mouseX-this.left)/this.width,n=(this.mouseY-this.top)/this.height;l=l<=0.5?(1-(l*2))*-180:((l-0.5)*2)*180;n=n<=0.5?(1-(n*2))*85:((n-0.5)*2)*-85;n=Math.max(-85,Math.min(85,n));this.x+=(l-this.x)*0.05;this.y+=(n-this.y)*0.05;if((this.click||this.mouse)&&Math.abs(l-this.x)<1&&Math.abs(n-this.y)<1){this.controller=false}}else{if(this.thrw){if(this.mousedown){this.vx=this.x-this.oldX;this.vy=this.y-this.oldY;this.oldX=this.x;this.oldY=this.y}else{var k=Math.abs(this.vx),j=Math.abs(this.vy);if(k>0.01){this.x+=this.vx}if(j>0.01){this.y+=this.vy}this.vx*=this.throwSpeed;this.vy*=this.throwSpeed;if(k<=0.01&&j<=0.01){this.controller=false}}}}}}var i=THREE.Math.degToRad(this.x),m=THREE.Math.degToRad(90-this.y);this.camera.target.x=Math.sin(m)*Math.cos(i);this.camera.target.z=Math.sin(m)*Math.sin(i);this.camera.target.y=Math.cos(m);this.camera.lookAt(this.camera.target);if(this.smoothZoom){this.camera.fov+=((this.fov*this.zoomVal)-this.camera.fov)*0.05;this.camera.updateProjectionMatrix()}this.renderer.render(this.scene,this.camera);d(this.onRender)},onLeave:function(){clearInterval(this.actionTimer);clearInterval(this.zoomTimer)},clear:function(){clearInterval(this.actionTimer);clearInterval(this.zoomTimer);this.distX=false;this.distY=false},onAction:function(){this.action(this.actionType,this.actionPerc)},action:function(l,j){var i,k;switch(l){case"left":this.distX=this.x+(-180*j);break;case"right":this.distX=this.x+(180*j);break;case"up":k=this.y+(85*j);this.distY=Math.max(-85,Math.min(85,k));break;case"down":k=this.y+(-85*j);this.distY=Math.max(-85,Math.min(85,k));break;case"leftstart":i="left";break;case"rightstart":i="right";break;case"upstart":i="up";break;case"downstart":i="down";break;case"leftend":case"rightend":case"upend":case"downend":clearInterval(this.actionTimer);break;case"zoomin":clearInterval(this.zoomTimer);this.zooming("gestureend",0.5);break;case"zoomout":clearInterval(this.zoomTimer);this.zooming("gestureend",1.5);break;case"zoominstart":clearInterval(this.zoomTimer);this.inZoom();this.zoomTimer=setInterval(this.inZoom,100);break;case"zoomoutstart":clearInterval(this.zoomTimer);this.outZoom();this.zoomTimer=setInterval(this.outZoom,100);break;case"zoominend":case"zoomoutend":clearInterval(this.zoomTimer);break}if(i){this.clear();this.actionPerc=j;this.actionType=i;this.fireAction();this.actionTimer=setInterval(this.fireAction,100)}},zooming:function(i,j){var k;this.prevZoom=this.zoomVal;if(i!=="gestureend"){k=i.type;j=i.scale}else{k=i}if(k!=="gestureend"){if(i.originalEvent.wheelDelta>0||i.originalEvent.detail<0){this.zoomVal-=0.05}else{this.zoomVal+=0.05}}else{if(j<1){this.zoomVal-=0.05}else{this.zoomVal+=0.05}}this.zoomVal=Math.max(this.zoomMax,Math.min(this.zoomMin,this.zoomVal));if(this.zoomVal===this.zoomMax||this.zoomVal===this.zoomMin){clearInterval(this.zoomTimer)}if(!this.smoothZoom){this.camera.fov=this.fov*this.zoomVal;this.camera.updateProjectionMatrix()}return false},zoomIn:function(){this.zooming("gestureend",0.5)},zoomOut:function(){this.zooming("gestureend",1.5)},imgChange:function(){this.timer=setTimeout(this.onStart,500)},update:function(l,j,k){clearTimeout(this.timer);this.removeEvents();this.paused=true;switch(l){case"image":this.newImage=true;this.material.map=this.texture.load(j,this.onImgChange);break;case"controls":this.controls=j;if(j!=="none"){this.drag=j==="drag";this.thrw=j==="throw";this.mouse=j==="mouse";this.click=j==="click";this.move=this.drag||this.thrw}else{this.x=0;this.y=0}break;case"autoplay":this.autoplay=j=="true";break;case"direction":var i=j==="forward"?1:-1;this.speed=this.autoplaySpeed*i;break;case"zoom":if(j=="false"){delete this.zoom;this.zoomVal=1;this.camera.fov=this.fov;this.camera.updateProjectionMatrix()}else{this.zoom=true}break;case"smooth":this.smoothZoom=j=="true";break}if(l!=="image"){this.timer=setTimeout(this.onStart,500)}},resize:function(j,i){this.width=j;this.height=i;this.renderer.setSize(j,i);this.camera.aspect=j/i;this.camera.updateProjectionMatrix()},onReset:function(){this.paused=true;this.currentSlide=true;this.x=0;this.y=0;this.distX=false;this.distY=false;this.zoomVal=1;this.camera.fov=this.fov;this.camera.updateProjectionMatrix();if(!this.imgLoaded){this.material.map=this.texture.load(this.image,this.onStart)}else{this.start()}},enterMouse:function(j,i){if(this.move){this.canvas.removeClass("rsaddon-panorama-drag").addClass("rsaddon-panorama-dragging")}this.clear();this.controller=true;this.mousedown=true;var k=this.slider.offset();this.left=k.left;this.top=k.top;if(!i){var l=j.originalEvent.touches;if(l){j=l[0]}this.startX=j.pageX-this.left;this.startY=j.pageY-this.top;this.prevX=this.x;this.prevY=this.y;this.oldX=this.x;this.oldY=this.y;this.canvas.on("mousemove.rsaddonpanorama touchmove.rsaddonpanorama",this.onMouse)}},mouseEvent:function(i){this.onLeave();if(i.type.search(/move|click/)!==-1){if(this.move){if(!this.controller||!this.mousedown){return}}else{if(!this.controller){this.enterMouse(i,true)}}var j=i.originalEvent.touches;if(j){i=j[0]}if(!this.move){this.mouseX=i.pageX;this.mouseY=i.pageY}else{this.x=this.prevX+((this.startX-(i.pageX-this.left))*0.1);this.y=this.prevY+(((i.pageY-this.top)-this.startY)*0.1)}}else{if(i.type.search(/down|enter|start/)!==-1){this.enterMouse(i)}else{this.canvas.off("mousemove.rsaddonpanorama touchmove.rsaddonpanorama");if(this.drag){this.controller=false}this.mousedown=false;if(this.move){this.canvas.removeClass("rsaddon-panorama-dragging").addClass("rsaddon-panorama-drag")}}}},addEvents:function(){switch(this.controls){case"drag":case"throw":this.canvas.on("mousedown.rsaddonpanorama mouseup.rsaddonpanorama mouseleave.rsaddonpanorama touchstart.rsaddonpanorama touchend.rsaddonpanorama touchcancel.rsaddonpanorama",this.onMouse);break;case"click":this.slide.on("click.rsaddonpanorama",this.onMouse);break;case"mouse":this.slide.on("mousemove.rsaddonpanorama touchmove.rsaddonpanorama",this.onMouse);break}if(this.zoom){this.slider.on("mousewheel.rsaddonpanorama DOMMouseScroll.rsaddonpanorama gestureend.rsaddonpanorama",this.onZoom)}if(this.controls!=="none"){if(this.move){this.canvas.addClass("rsaddon-panorama-drag")}else{if(this.click){this.slide.addClass("rsaddon-panorama-click")}}}},removeEvents:function(){this.clear();this.mousedown=false;this.controller=false;this.currentSlide=false;switch(this.controls){case"drag":case"throw":this.canvas.off(".rsaddonpanorama");break;case"mouse":case"click":this.slide.off(".rsaddonpanorama");break}this.slider.off(".rsaddonpanorama");this.slide.removeClass("rsaddon-panorama-click");this.canvas.removeClass("rsaddon-panorama-drag rsaddon-panorama-dragging")},destroy:function(){for(var i in this){if(this.hasOwnProperty(i)){delete this[i]}}}};function b(i){i.stopPropagation()}function h(){var l=jQuery(this),m=l.data().actions;if(l.hasClass("rspanoaction")||!Array.isArray(m)){return}var j=m.length,k;while(j--){k=m[j];if(k.action.search("panorama")!==-1){l.addClass("rspanoaction").on("mousedown click mousemove touchmove",b)}}}function f(){var i;try{i=document.createElement("canvas");i=!!(window.WebGLRenderingContext&&(i.getContext("webgl")||i.getContext("experimental-webgl")));if(i){i="WebGLRenderer"}}catch(j){}if(!i){i=window.CanvasRenderingContext2D;if(i){i="CanvasRenderer"}}return i}})();