/*!
 * jQuery.filer
 * Copyright (c) 2015 CreativeDream
 * Website: https://github.com/CreativeDream/jquery.filer
 * Version: 1.0.3 (26-Aug-2015)
 * Requires: jQuery v1.7.1 or later
 */
;!function(a){a.fn.filer=function(b){return this.each(function(j,g){var p=a(g),h=".jFiler",c=a(),e=a(),t=a(),m=[],k=a.extend(!0,{},a.fn.filer.defaults,b),q={init:function(){p.wrap('<div class="jFiler"></div>'),c=p.closest(h),q._changeInput()},_bindInput:function(){k.changeInput&&e.size()>0&&e.bind("click",q._clickHandler),p.on({focus:function(){e.addClass("focused")},blur:function(){e.removeClass("focused")},change:function(){q._onChange()}}),k.dragDrop&&(e.length>0?e:p).bind("drop",q._dragDrop.drop).bind("dragover",q._dragDrop.dragEnter).bind("dragleave",q._dragDrop.dragLeave),k.uploadFile&&k.clipBoardPaste&&a(window).on("paste",q._clipboardPaste)},_unbindInput:function(){k.changeInput&&e.size()>0&&e.unbind("click",q._clickHandler)},_clickHandler:function(){p.click()},_applyAttrSettings:function(){var l=["name","limit","maxSize","extensions","changeInput","showThumbs","appendTo","theme","addMore","excludeName","files"];for(var f in l){var d="data-jfiler-"+l[f];if(q._assets.hasAttr(d)){switch(l[f]){case"changeInput":case"showThumbs":case"addMore":k[l[f]]=["true","false"].indexOf(p.attr(d))>-1?"true"==p.attr(d):p.attr(d);break;case"extensions":k[l[f]]=p.attr(d).replace(/ /g,"").split(",");break;case"files":k[l[f]]=JSON.parse(p.attr(d));break;default:k[l[f]]=p.attr(d)}p.removeAttr(d)}}},_changeInput:function(){if(q._applyAttrSettings(),k.theme&&c.addClass("jFiler-theme-"+k.theme),"input"!=p.get(0).tagName.toLowerCase()&&"file"!=p.get(0).type){e=p,p=a('<input type="file" name="'+k.name+'" />'),p.css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"}),c.prepend(p),q._isGn=p}else{if(k.changeInput){switch(typeof k.changeInput){case"boolean":e=a('<div class="jFiler-input"><div class="jFiler-input-caption"><span>'+k.captions.feedback+'</span></div><div class="jFiler-input-button">'+k.captions.button+'</div></div>"');break;case"string":case"object":e=a(k.changeInput);break;case"function":e=a(k.changeInput(c,p,k))}p.after(e),p.css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"})}}(!k.limit||k.limit&&k.limit>=2)&&(p.attr("multiple","multiple"),"[]"!=p.attr("name").slice(-2)?p.attr("name",p.attr("name")+"[]"):null),q._bindInput(),k.files&&q._append(!1,{files:k.files})},_clear:function(){q.files=null,k.uploadFile||k.addMore||q._reset(),q._set("feedback",q._itFl&&q._itFl.length>0?q._itFl.length+" "+k.captions.feedback2:k.captions.feedback),null!=k.onEmpty&&"function"==typeof k.onEmpty?k.onEmpty(c,e,p):null},_reset:function(f){if(!f){if(!k.uploadFile&&k.addMore){for(var d=0;d<m.length;d++){m[d].remove()}m=[],q._unbindInput(),p=q._isGn?q._isGn:a(g),q._bindInput()}q._set("input","")}q._itFl=[],q._itFc=null,q._ajFc=0,q._prEr||(q._itFr=[],c.find("input[name^='jfiler-items-exclude-']:hidden").remove()),t.fadeOut("fast",function(){a(this).remove()}),t=a()},_set:function(f,d){switch(f){case"input":p.val("");break;case"feedback":e.length>0&&e.find(".jFiler-input-caption span").html(d)}},_filesCheck:function(){var r=0;if(k.limit&&q.files.length+q._itFl.length>k.limit){return alert(q._assets.textParse(k.captions.errors.filesLimit)),!1}for(var o=0;o<q.files.length;o++){var s=q.files[o].name.split(".").pop().toLowerCase(),f=q.files[o],d={name:f.name,size:f.size,size2:q._assets.bytesToSize(f.size),type:f.type,ext:s};if(null!=k.extensions&&-1==a.inArray(s,k.extensions)){return alert(q._assets.textParse(k.captions.errors.filesType,d)),!1}if(null!=k.maxSize&&q.files[o].size>1048576*k.maxSize){return alert(q._assets.textParse(k.captions.errors.filesSize,d)),!1}if(4096==f.size&&0==f.type.length){return !1}r+=q.files[o].size}if(null!=k.maxSize&&r>=Math.round(1048576*k.maxSize)){return alert(q._assets.textParse(k.captions.errors.filesSizeAll)),!1}if(k.addMore||k.uploadFile){var d=q._itFl.filter(function(i){return i.file.name!=f.name||i.file.size!=f.size||i.file.type!=f.type||(f.lastModified?i.file.lastModified!=f.lastModified:0)?void 0:!0});if(d.length>0){return !1}}return !0},_thumbCreator:{create:function(B){var x=q.files[B],v=q._itFc?q._itFc.id:B,A=x.name,w=x.size,f=x.type.split("/",1).toString().toLowerCase(),u=-1!=A.indexOf(".")?A.split(".").pop().toLowerCase():"",y=k.uploadFile?'<div class="jFiler-jProgressBar">'+k.templates.progressBar+"</div>":"",s={id:v,name:A,size:w,size2:q._assets.bytesToSize(w),type:f,extension:u,icon:q._assets.getIcon(u,f),icon2:q._thumbCreator.generateIcon({type:f,extension:u}),image:'<div class="jFiler-item-thumb-image fi-loading"></div>',progressBar:y,_appended:x._appended},z="";return x.opts&&(s=a.extend({},x.opts,s)),z=a(q._thumbCreator.renderContent(s)).attr("data-jfiler-index",v),z.get(0).jfiler_id=v,q._thumbCreator.renderFile(x,z,s),x.forList?z:(q._itFc.html=z,z.hide()[k.templates.itemAppendToEnd?"appendTo":"prependTo"](t.find(k.templates._selectors.list)).show(),void (x._appended||q._onSelect(B)))},renderContent:function(d){return q._assets.textParse(d._appended?k.templates.itemAppend:k.templates.item,d)},renderFile:function(s,o,v){if(0==o.find(".jFiler-item-thumb-image").size()){return !1}if(s.file&&"image"==v.type){var f='<img src="'+s.file+'" draggable="false" />',d=o.find(".jFiler-item-thumb-image.fi-loading");return a(f).error(function(){f=q._thumbCreator.generateIcon(v),o.addClass("jFiler-no-thumbnail"),d.removeClass("fi-loading").html(f)}).load(function(){d.removeClass("fi-loading").html(f)}),!0}if(window.File&&window.FileList&&window.FileReader&&"image"==v.type&&v.size<6000000){var u=new FileReader;u.onload=function(r){var n='<img src="'+r.target.result+'" draggable="false" />',i=o.find(".jFiler-item-thumb-image.fi-loading");a(n).error(function(){n=q._thumbCreator.generateIcon(v),o.addClass("jFiler-no-thumbnail"),i.removeClass("fi-loading").html(n)}).load(function(){i.removeClass("fi-loading").html(n)})},u.readAsDataURL(s)}else{var f=q._thumbCreator.generateIcon(v),d=o.find(".jFiler-item-thumb-image.fi-loading");o.addClass("jFiler-no-thumbnail"),d.removeClass("fi-loading").html(f)}},generateIcon:function(s){var o=new Array(3);if(s&&s.type&&s.extension){switch(s.type){case"image":o[0]="f-image",o[1]='<i class="icon-jfi-file-image"></i>';break;case"video":o[0]="f-video",o[1]='<i class="icon-jfi-file-video"></i>';break;case"audio":o[0]="f-audio",o[1]='<i class="icon-jfi-file-audio"></i>';break;default:o[0]="f-file f-file-ext-"+s.extension,o[1]=s.extension.length>0?"."+s.extension:"",o[2]=1}}else{o[0]="f-file",o[1]=s.extension&&s.extension.length>0?"."+s.extension:"",o[2]=1}var v='<span class="jFiler-icon-file '+o[0]+'">'+o[1]+"</span>";if(1==o[2]){var f=q._assets.text2Color(s.extension);if(f){var d=a(v).appendTo("body"),u=d.css("box-shadow");u=f+u.substring(u.replace(/^.*(rgba?\([^)]+\)).*$/,"$1").length,u.length),d.css({"-webkit-box-shadow":u,"-moz-box-shadow":u,"box-shadow":u}).attr("style","-webkit-box-shadow: "+u+"; -moz-box-shadow: "+u+"; box-shadow: "+u+";"),v=d.prop("outerHTML"),d.remove()}}return v},_box:function(f){if(null!=k.beforeShow&&"function"==typeof k.beforeShow?!k.beforeShow(q.files,t,c,e,p):!1){return !1}if(t.length<1){if(k.appendTo){var d=a(k.appendTo)}else{var d=c}d.find(".jFiler-items").remove(),t=a('<div class="jFiler-items jFiler-row"></div>'),t.append(q._assets.textParse(k.templates.box)).appendTo(d),t.on("click",k.templates._selectors.remove,function(o){o.preventDefault();var r=k.templates.removeConfirmation?confirm(k.captions.removeConfirmation):!0;r&&q._remove(f?f.remove.event:o,f?f.remove.el:a(this).closest(k.templates._selectors.item))})}for(var l=0;l<q.files.length;l++){q.files[l]._appended||(q.files[l]._choosed=!0),q._addToMemory(l),q._thumbCreator.create(l)}}},_upload:function(){var f=q._itFc.html,d=new FormData;if(d.append(p.attr("name"),q._itFc.file,q._itFc.file.name?q._itFc.file.name:!1),null!=k.uploadFile.data&&a.isPlainObject(k.uploadFile.data)){for(var l in k.uploadFile.data){d.append(l,k.uploadFile.data[l])}}q._ajax.send(f,d,q._itFc)},_ajax:{send:function(f,d,l){return l.ajax=a.ajax({url:k.uploadFile.url,data:d,type:k.uploadFile.type,enctype:k.uploadFile.enctype,xhr:function(){var n=a.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(i){q._ajax.progressHandling(i,f)},!1),n},complete:function(n,i){l.ajax=!1,q._ajFc++,q._ajFc>=q.files.length&&(q._ajFc=0,null!=k.uploadFile.onComplete&&"function"==typeof k.uploadFile.onComplete?k.uploadFile.onComplete(t,c,e,p,n,i):null)},beforeSend:function(o,n){return null!=k.uploadFile.beforeSend&&"function"==typeof k.uploadFile.beforeSend?k.uploadFile.beforeSend(f,t,c,e,p,l.id,o,n):!0},success:function(r,o,n){l.uploaded=!0,null!=k.uploadFile.success&&"function"==typeof k.uploadFile.success?k.uploadFile.success(r,f,t,c,e,p,l.id,o,n):null},error:function(r,o,n){l.uploaded=!1,null!=k.uploadFile.error&&"function"==typeof k.uploadFile.error?k.uploadFile.error(f,t,c,e,p,l.id,r,o,n):null},statusCode:k.uploadFile.statusCode,cache:!1,contentType:!1,processData:!1}),l.ajax},progressHandling:function(l,f){if(l.lengthComputable){var d=Math.round(100*l.loaded/l.total).toString();null!=k.uploadFile.onProgress&&"function"==typeof k.uploadFile.onProgress?k.uploadFile.onProgress(d,f,t,c,e,p):null,f.find(".jFiler-jProgressBar").find(k.templates._selectors.progressBar).css("width",d+"%")}}},_dragDrop:{dragEnter:function(d){d.preventDefault(),d.stopPropagation(),c.addClass("dragged"),q._set("feedback",k.captions.drop),null!=k.dragDrop.dragEnter&&"function"==typeof k.dragDrop.dragEnter?k.dragDrop.dragEnter(d,e,p,c):null},dragLeave:function(d){return d.preventDefault(),d.stopPropagation(),q._dragDrop._dragLeaveCheck(d)?(c.removeClass("dragged"),q._set("feedback",k.captions.feedback),void (null!=k.dragDrop.dragLeave&&"function"==typeof k.dragDrop.dragLeave?k.dragDrop.dragLeave(d,e,p,c):null)):!1},drop:function(d){d.preventDefault(),c.removeClass("dragged"),!d.originalEvent.dataTransfer.files||d.originalEvent.dataTransfer.files.length<=0||(q._set("feedback",k.captions.feedback),q._onChange(d,d.originalEvent.dataTransfer.files),null!=k.dragDrop.drop&&"function"==typeof k.dragDrop.drop?k.dragDrop.drop(d.originalEvent.dataTransfer.files,d,e,p,c):null)},_dragLeaveCheck:function(f){var d=f.relatedTarget,l=!1;return d!==e&&(d&&(l=a.contains(e,d)),l)?!1:!0}},_clipboardPaste:function(s,r){if((r||s.originalEvent.clipboardData||s.originalEvent.clipboardData.items)&&(!r||s.originalEvent.dataTransfer||s.originalEvent.dataTransfer.items)&&!q._clPsePre){var o=r?s.originalEvent.dataTransfer.items:s.originalEvent.clipboardData.items,u=function(B,E,z){E=E||"",z=z||512;for(var x=atob(B),D=[],y=0;y<x.length;y+=z){for(var v=x.slice(y,y+z),w=new Array(v.length),F=0;F<v.length;F++){w[F]=v.charCodeAt(F)}var C=new Uint8Array(w);D.push(C)}var A=new Blob(D,{type:E});return A};if(o){for(var f=0;f<o.length;f++){if(-1!==o[f].type.indexOf("image")||-1!==o[f].type.indexOf("text/uri-list")){if(r){try{window.atob(s.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1])}catch(s){return}}var d=r?u(s.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1],"image/png"):o[f].getAsFile();d.name=Math.random().toString(36).substring(5),d.name+=-1!=d.type.indexOf("/")?"."+d.type.split("/")[1].toString().toLowerCase():".png",q._onChange(s,[d]),q._clPsePre=setTimeout(function(){delete q._clPsePre},1000)}}}}},_onSelect:function(d){k.uploadFile&&!a.isEmptyObject(k.uploadFile)&&q._upload(d),null!=k.onSelect&&"function"==typeof k.onSelect?k.onSelect(q.files[d],q._itFc.html,t,c,e,p):null,d+1>=q.files.length&&(null!=k.afterShow&&"function"==typeof k.afterShow?k.afterShow(t,c,e,p):null)},_onChange:function(o,f){if(f){if(!f||0==f.length){return q._set("input",""),q._clear(),!1}q.files=f}else{if(!p.get(0).files||"undefined"==typeof p.get(0).files||0==p.get(0).files.length){return k.uploadFile||k.addMore||(q._set("input",""),q._clear()),!1}q.files=p.get(0).files}if(k.uploadFile||k.addMore||q._reset(!0),!q._filesCheck()){return q._set("input",""),q._clear(),!1}if(q._set("feedback",q.files.length+q._itFl.length+" "+k.captions.feedback2),k.showThumbs){q._thumbCreator._box()}else{for(var u=0;u<q.files.length;u++){q.files[u]._choosed=!0,q._addToMemory(u),q._onSelect(u)}}if(!k.uploadFile&&k.addMore){var d=a('<input type="file" />'),s=p.prop("attributes");a.each(s,function(){d.attr(this.name,this.value)}),p.after(d),q._unbindInput(),m.push(d),p=d,q._bindInput()}},_append:function(l,f){var d=f?f.files:!1;if(d&&!(d.length<=0)&&(q.files=d,k.showThumbs)){for(var o=0;o<q.files.length;o++){q.files[o]._appended=!0}q._thumbCreator._box()}},_getList:function(r,o){var f=o?o.files:!1;if(f&&!(f.length<=0)&&(q.files=f,k.showThumbs)){for(var s=[],d=0;d<q.files.length;d++){q.files[d].forList=!0,s.push(q._thumbCreator.create(d))}o.callback&&o.callback(s,t,c,e,p)}},_retryUpload:function(l,f){var o=parseInt("object"==typeof f?f.attr("data-jfiler-index"):f),d=q._itFl.filter(function(i){return i.id==o});return d.length>0?!k.uploadFile||a.isEmptyObject(k.uploadFile)||d[0].uploaded?void 0:(q._itFc=d[0],q._upload(o),!0):!1},_remove:function(i,v){if(v.binded){if(v.data.id&&(v=t.find(k.templates._selectors.item+"[data-jfiler-index='"+v.data.id+"']"),0==v.size())){return !1}v.data.el&&(v=v.data.el)}var f=v.get(0).jfiler_id||v.attr("data-jfiler-index"),s=null,r=function(x){var C=c.find("input[name^='jfiler-items-exclude-']:hidden").first(),w=q._itFl[x],B=[];if(0==C.size()&&(C=a('<input type="hidden" name="jfiler-items-exclude-'+(k.excludeName?k.excludeName:("[]"!=p.attr("name").slice(-2)?p.attr("name"):p.attr("name").substring(0,p.attr("name").length-2))+"-"+j)+'">'),C.appendTo(c)),w.file._choosed||w.file._appended||w.uploaded){if(q._prEr=!0,q._itFr.push(w),k.addMore){var y=w.input,A=0;q._itFl.filter(function(d){d.file._choosed&&d.input.get(0)==y.get(0)&&A++}),1==A&&(q._itFr=q._itFr.filter(function(d){return d.file._choosed?d.input.get(0)!=y.get(0):!0}),y.val(""),q._prEr=!1)}for(var z=0;z<q._itFr.length;z++){B.push(q._itFr[z].file.name)}B=JSON.stringify(B),C.val(B)}},u=function(l,d){r(d),q._itFl.splice(d,1),q._itFl.length<1?(q._reset(),q._clear()):q._set("feedback",q._itFl.length+" "+k.captions.feedback2),l.fadeOut("fast",function(){a(this).remove()})};for(var o in q._itFl){"length"!==o&&q._itFl.hasOwnProperty(o)&&q._itFl[o].id==f&&(s=o)}return q._itFl.hasOwnProperty(s)?q._itFl[s].ajax?(q._itFl[s].ajax.abort(),void u(v,s)):(null!=k.onRemove&&"function"==typeof k.onRemove?k.onRemove(v,q._itFl[s].file,s,t,c,e,p):null,void u(v,s)):!1},_addToMemory:function(d){q._itFl.push({id:q._itFl.length,file:q.files[d],html:a(),ajax:!1,uploaded:!1}),k.addMore&&!q.files[d]._appended&&(q._itFl[q._itFl.length-1].input=p),q._itFc=q._itFl[q._itFl.length-1]},_assets:{bytesToSize:function(l){if(0==l){return"0 Byte"}var f=1000,d=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(l)/Math.log(f));return(l/Math.pow(f,o)).toPrecision(3)+" "+d[o]},hasAttr:function(l,f){var f=f?f:p,d=f.attr(l);return d&&"undefined"!=typeof d?!0:!1},getIcon:function(f,d){var l=["audio","image","text","video"];return a.inArray(d,l)>-1?'<i class="icon-jfi-file-'+d+" jfi-file-ext-"+f+'"></i>':'<i class="icon-jfi-file-o jfi-file-type-'+d+" jfi-file-ext-"+f+'"></i>'},textParse:function(f,d){switch(d=a.extend({},{limit:k.limit,maxSize:k.maxSize},d&&a.isPlainObject(d)?d:{}),typeof f){case"string":return f.replace(/\{\{fi-(.*?)\}\}/g,function(l,i){return i=i.replace(/ /g,""),i.match(/(.*?)\|limitTo\:(\d+)/)?i.replace(/(.*?)\|limitTo\:(\d+)/,function(s,r,u){var r=d[r]?d[r]:"",o=r.substring(0,u);return o=r.length>o.length?o.substring(0,o.length-3)+"...":o}):d[i]?d[i]:""});case"function":return f(d);default:return f}},text2Color:function(l){if(!l||0==l.length){return !1}for(var f=0,d=0;f<l.length;d=l.charCodeAt(f++)+((d<<5)-d)){}for(var f=0,o="#";3>f;o+=("00"+(d>>2*f++&255).toString(16)).slice(-2)){}return o}},files:null,_itFl:[],_itFc:null,_itFr:[],_ajFc:0,_prEr:!1};return q.init(),p.on("filer.append",function(f,d){q._append(f,d)}),p.on("filer.remove",function(f,d){d.binded=!0,q._remove(f,d)}),p.on("filer.reset",function(){return q._reset(),q._clear(),!0}),p.on("filer.generateList",function(f,d){return q._getList(f,d)}),p.on("filer.retry",function(f,d){return q._retryUpload(f,d)}),this})},a.fn.filer.defaults={limit:null,maxSize:null,extensions:null,changeInput:!0,showThumbs:!1,appendTo:null,theme:null,templates:{box:null,item:null,itemAppend:null,progressBar:null,itemAppendToEnd:!1,removeConfirmation:!0,_selectors:{list:null,item:null,progressBar:null,remove:null}},files:null,uploadFile:null,dragDrop:null,addMore:!1,clipBoardPaste:!0,excludeName:null,beforeShow:null,onSelect:null,afterShow:null,onRemove:null,onEmpty:null,captions:{button:"Choose Files",feedback:"Choose files To Upload",feedback2:"files were chosen",drop:"Drop file here to Upload",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only {{fi-limit}} files are allowed to be uploaded.",filesType:"Only Images are allowed to be uploaded.",filesSize:"{{fi-name}} is too large! Please upload file up to {{fi-maxSize}} MB.",filesSizeAll:"Files you've choosed are too large! Please upload files up to {{fi-maxSize}} MB."}}}}(jQuery);